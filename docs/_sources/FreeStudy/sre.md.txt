# SRE

## 1 SREの原則
### 1.1 リスクの受容
Googleは完全な信頼性を目指すサービスを構築していると一部で考えられているかもしれないが、事実として、ある程度以上の信頼性はむしろサービスやその利用者にとってマイナスとなることがある。これは過剰な信頼性がコストを増大させ、新機能の開発やプロダクトの提供速度を制限するためである。ユーザーは通常、サービスの高信頼性と極端な信頼性の差異を感じない。それはユーザーの体験が、移動体通信ネットワークや使用デバイスといった、より低い信頼性を持つ要素によって左右されるからだ。したがって、サイトリライアビリティエンジニアリングでは、稼働時間の最大化よりも、可用性のリスクとイノベーションの速度やサービス運用の効率性とのバランスを取ることを重視している。

#### リスクの管理
信頼性のないシステムは急速にユーザーの信頼を失うことになるため、システム障害の可能性は減らさなければならない。しかし、システムを構築すればするほど、信頼性とコストの関係は比例しない。信頼性を増し続けると、一定の増加率よりもコストが急速に増大することもある。この増大するコストには以下の二つの要素が含まれる。

1. **冗長なマシン／コンピュートリソースのコスト** : 設備の冗長化にコストを投入することにより、定期的なメンテナンスや予定外のメンテナンスの際にシステムをオフラインにせず、最小限のデータの耐久性を保証するためのパリティコードブロックを保存するための領域を確保することが可能となる。
2. **機会のコスト** : ユーザーが直接操作する機能ではなく、リスクを減らすためのシステムや機能を構築するために組織がエンジニアリングリソースを割り当てることにより発生するコスト。このような作業を行うエンジニアは、エンドユーザーが使う新機能や新プロダクトのための作業は行わなくなる。

SREでは、サービスの信頼性を管理する主要な部分はリスクを管理することによって行う。リスクは連続的なものと捉え、Googleのシステムの信頼性を高めるためのエンジニアリングとサービスの適切な障害許容レベルの設定は等しく重要である。これにより、コストとメリットの分析を行い、リスク曲線上で検索、Ads、Gmail、Photosなどのサービスをどこに配置するかを決定できる。

サービスの取るリスクと、そのビジネスが許容できるリスクを意識的に合わせることが目標である。信頼性を適切に保つ努力は行うが、無理に信頼性を高めすぎることは避ける。例えば、可用性の目標を99.99%と設定した場合、その目標を超えようとするが、大幅に超えることは望まない。その理由は、大幅に超えることで、新機能の追加や技術的な負債の払拭、運用コストの低減などのチャンスを逃す可能性があるからである。したがって、可用性の目標は下限だけでなく上限としても設定する。このような視点を持つことで、明確に、そしてより深くリスクを考慮した運用が可能となる。

#### サービスリスクの計測

Googleでは、システムの最適化において客観的なメトリクスが非常に有益であると考えている。これにより、現状のパフォーマンスの評価や時間の経過に伴う改善や劣化の追跡が可能となる。特にサービスのリスクについては、潜在的な要素を一つのメトリクスにまとめることが理想的である。しかし、サービスの障害はユーザーの不満、損害、信頼の喪失、直接的または間接的な売上の損失、ブランドや評価への影響など、さまざまな要素を含むため、その全てを計測することは困難である。そのため、Googleでは計画外の停止時間に注目している。


可用性=稼働時間/（稼働時間+停止時間）


可用性は通常、「9」の数で示され、99.9%や99.99%、99.999%などと表現される。この数字が増えるごとに、100%の可用性に近づく。しかし、Googleでは時間を基にしたメトリクスは意味をなさない（※）と考えており、代わりにリクエスト成功率を基に可用性を定義している。つまり、成功したリクエスト数を総リクエスト数で割ることで可用性を計算する。<br>
※世界中のどこかからサービスのトラフィックの少なくとも一部を提供している可能性は高くなっているため。少なくとも部分的には、常に「稼働中」になっている<br>


可用性=成功したリクエスト数/総リクエスト数


バッチ処理やパイプライン、ストレージ、トランザクションシステムなどのシステムでも、作業の成否を示す方法が明確に定義されていれば、可用性のメトリクスを適用することが可能である。たとえば、バッチ処理で顧客データベースの内容を取り出し、変換してデータウェアハウスに挿入する場合、処理に成功したレコード数と失敗したレコード数という観点で定義されたリクエスト成功率を使用することで、可用性のメトリクスを計算することが可能である。

Googleでは、サービスの可用性のターゲットを四半期単位で設定し、そのパフォーマンスを週単位、もしくは日単位で追跡している。これにより、対処する価値のある特異点を見つけ、追跡し、修復することができ、高レベルの可用性の目標を達成することが可能となる

#### サービスのリスク許容度
1. **コンシューマサービスにおけるリスク許容度の明確化** 





### 1.2 サービスレベルの目標



### 1.3 トイルの撲滅


### 1.4 分散システムのモニタリング

### 1.5 Googleにおける自動化の進化

### 1.6 リリースエンジニアリング

### 1.7 単純さ



## 参考
https://sre.google/sre-book/table-of-contents/
