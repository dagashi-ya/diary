# CI/CDについて

## 1. CI（Continuous Integration：継続的インテグレーション）

CIとは、開発者が頻繁にコードを共有リポジトリにマージするプラクティスである。それにより、バグを早期に発見し、小さな変更点で頻繁にアプリケーションをビルド・テストすることが可能となる。このプラクティスは、バグの早期発見、コンフリクトの解消、コード品質の向上に寄与する。

## 2. CD（Continuous Delivery：継続的デリバリー）

CDは、ソフトウェアを生産環境にリリースするプロセスを自動化するアプローチである。CIがビルドとテストの段階を自動化するのに対して、CDはデプロイを自動化し、アプリケーションを常にリリース可能な状態に保つ。

## 3. CI/CDのツール

CI/CDの実現には、いくつかのツールが存在する。以下はその一部である。

- Jenkins: オープンソースであり、高度にカスタマイズ可能なCI/CDツールである。
- GitHub Actions: GitHub内で直接CI/CDパイプラインを設定・実行できる機能である。
- GitLab CI/CD: GitLab内でCI/CDパイプラインを設定・実行するための機能である。
- Travis CI: オープンソースプロジェクトに対して無料で提供されるCI/CDサービスである。

## 4. CI/CDのメリット

CI/CDの導入により、以下のメリットが得られる。

- **エラーの早期発見**: 頻繁にコードのビルドとテストを行うことで、エラーやバグを早期に発見できる。
- **デプロイ時間の短縮**: デプロイプロセスを自動化することにより、新機能やバグ修正をより早く顧客に提供できる。
- **開発の効率化**: 手動でのビルドやデプロイプロセスを自動化することで、開発チームはより重要なタスクに集中できる。

## 5. そもそもデプロイ戦略について
### デプロイの種類
1. **ブルーグリーンデプロイ**:
ブルーグリーンデプロイは、稼働環境（ブルー）と新環境（グリーン）の2つの環境を用意し、新環境に新しいバージョンをデプロイする方式である。デプロイが完了したら、トラフィックを新環境に切り替える。問題が生じた場合は、すぐに稼働環境に切り戻せるのが特徴である。

2. **イミュータブルデプロイ**:
イミュータブルデプロイは、新しいバージョンを既存のサーバにアップデートするのではなく、新しいバージョンのための新しいサーバを作成し、そこにデプロイする方式である。こうすることで、既存の稼働環境を変更することなく新バージョンのデプロイを行うことができ、問題が生じた場合にも影響を最小限に留めることができる。

3. **シンボリックデプロイ**:
シンボリックデプロイは、新旧バージョンを両方用意し、稼働するバージョンをシンボリックリンクで切り替える方式である。デプロイ後も旧バージョンが残っているため、何か問題が発生した場合にはすぐに旧バージョンに戻すことができる。

4.**ローリングデプロイ**:
ローリングデプロイは、サービスを一部ずつ更新する方式である。これにより、デプロイ中もサービスを続けることが可能となる。新しいバージョンに問題があった場合でも、全インスタンスが一度に影響を受けることがない。

### デプロイ戦略の評価軸

デプロイとは、必要なアプリケーションのリビジョンを所望の環境に反映し、特にWEBサービスであればリクエストを受け付けるようにすることである。これを実現する方法として、大きく以下の2つの方法がある。

| 実現方法 | 説明 |
|:--------|:-----|
| In place | インスタンスはそのままに、新しいリビジョンのアプリのみをその場で反映させる |
| Blue/Green | 新しいリビジョンのアプリ用に、新しいインスタンスを構築して入れ替える |

そして、実現方法とは別の軸で、反映のスピードで大まかに以下の2つの分類ができる。

| 反映スピード | 説明 |
|:--------|:-----|
| 一括 | 全台を一斉に新しいリビジョンでデプロイする |
| ローリング | 1台ずつ新しいリビジョンをデプロイする |

よくBlue/Greenデプロイを「新しいリビジョンのインスタンスを、今と同じ台数構築して一気に切り替える」というやり方のみで考えている方がいるが、昨今そういったデプロイ方式はRed/Blackデプロイとも呼ばれている。これは「Blue/GreenでAll at onceにデプロイする」という1つのやり方に過ぎない。

## 6.そもそもテスト戦略について
### テストの種類
1. **A/Bテスト**: 主に製品の改善を目指して行われ、ユーザーの行動や反応を比較分析する。ユーザーには同時に二つの異なるバージョン（AとB）が提示され、どちらがより良いパフォーマンスを示すかを評価します。ユーザーエクスペリエンス、コンバージョン率、その他のKPI（重要業績評価指標）の改善を目指しています。

2. **カナリアテスト**: 新しいバージョンのソフトウェアが引き起こす可能性のある問題を早期に検出することを目的としています。新しいバージョンはまず一部のユーザー（「カナリア」）にだけリリースされ、問題が発生した場合はその影響を一部のユーザーに限定できます。問題がなければ新しいバージョンを全体のユーザーにリリースします。

3. **シャドーテスト**: シャドーテストは、新システムを本番環境と並行して運用し、同じデータや負荷を受けて正しく動作するかをテストします。実際のユーザーに影響を与えることなく、新システムのパフォーマンスや問題点を把握することが目的です。

### テスト戦略の評価軸

| 目的 | 説明 |
|:--------|:-----|
| UI/IXの向上 | ユーザーエクスペリエンス、コンバージョン率、その他のKPI（重要業績評価指標）の改善を目的とする |
| 障害の早期検知 | 問題が発生した場合はその影響を一部のユーザーに限定する|

そして、目的とは別の軸で、商用影響の有無で分類することが出来る

## 参考
[アプリケーションのデプロイとテストの戦略](https://cloud.google.com/architecture/application-deployment-and-testing-strategies?hl=ja#canary_test_pattern)
